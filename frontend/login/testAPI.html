<!doctype html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <title>Test API</title>
    <style>
      body { font-family: sans-serif; max-width: 680px; margin: 24px auto; }
      input, button { padding: 8px; margin: 4px 0; }
      pre { background: #111; color: #eee; padding: 12px; border-radius: 8px; }
    </style>
  </head>
  <body>
    <h2>Login & call protected API</h2>

    <label>Username</label><br/>
    <input id="u" value="admin"/><br/>

    <label>Password</label><br/>
    <input id="p" value="admin" type="password"/><br/>

    <button id="btnLogin">Login</button>
    <button id="btnUsers" disabled>Call /users</button>

    <h3>Output</h3>
    <pre id="out">...</pre>

    <script>
      const BASE_URL = 'http://localhost:8080/api';
      let TOKEN = null;

      const out = (v) => document.getElementById('out').textContent =
        (typeof v === 'string' ? v : JSON.stringify(v, null, 2));

      document.getElementById('btnLogin').onclick = async () => {
        try {
          const username = document.getElementById('u').value;
          const password = document.getElementById('p').value;

          const res = await fetch(`${BASE_URL}/auth/token`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password })
          });

          const data = await res.json();
          if (!res.ok) throw new Error(JSON.stringify(data));

          TOKEN = data?.result?.token;
          if (!TOKEN) throw new Error('Không thấy token trong response');
          out({ token: TOKEN });
          document.getElementById('btnUsers').disabled = false;
        } catch (e) {
          out(`Login error: ${e.message}`);
        }
      };

      document.getElementById('btnUsers').onclick = async () => {
        try {
          // Đổi /users sang endpoint thật của bạn nếu khác
          const res = await fetch(`${BASE_URL}/users`, {
            headers: { Authorization: `Bearer ${TOKEN}` }
          });
          const data = await res.json();
          if (!res.ok) throw new Error(JSON.stringify(data));
          out(data);
        } catch (e) {
          out(`Protected API error: ${e.message}`);
        }
      };
    </script>
  </body>
</html>